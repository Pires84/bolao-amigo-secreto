<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïµÔ∏è Amigo Secreto RH Palpites - V4</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <div class="container">
        
        <header class="header">
            <h1>üïµÔ∏è AMIGO SECRETO RH PALPITES</h1>
            <div class="header-controls">
                <div class="user-selector">
                    <label for="user-select">Utilizador:</label>
                    <select id="user-select"></select>
                </div>
                <button id="exportBtn" class="primary-btn export-btn">
                    EXPORTAR DADOS
                </button>
            </div>
        </header>

        <div id="dashboard-view" class="view-active">
            
            <div class="status-grid">
                <div class="card status-card">
                    <p class="card-title">‚è≥ PRAZO FINAL</p>
                    <div class="countdown-timer" id="countdown-timer">
                        <span id="days">00</span>d : <span id="hours">00</span>h : <span id="minutes">00</span>m : <span id="seconds">00</span>s
                    </div>
                    <p class="data-limite" id="dataLimiteDisplay">00/00/0000</p>
                    <p id="countdown-finished" style="display: none;">PRAZO ENCERRADO!</p>
                </div>

                <div class="card status-card financial-summary">
                    <p class="card-title">üèÜ PR√âMIO TOTAL</p>
                    <h3 class="premio-total">R$ <span id="premioTotalDisplay">0.00</span></h3>
                    <p class="financial-detail">Contribui√ß√£o: R$ <span id="valorPalpiteDisplay">10.00</span> / pessoa</p>
                    <p class="financial-detail">Total Participantes: <span id="numParticipantesDisplay"></span></p>
                </div>
            </div>

            <button id="goToPalpiteBtn" class="primary-btn full-width-btn">
                ‚û°Ô∏è REGISTRAR / ALTERAR MEUS PALPITES
            </button>

            <div class="result-mode-section" id="resultModeSection" style="display: none;">
                <p class="warning-text" id="gabaritoWarning">
                    ‚ö†Ô∏è RESULTADOS DISPON√çVEIS SE GABARITO FOR PREENCHIDO!
                </p>
                <button id="showResultsBtn" class="primary-btn">VER MINHA PONTUA√á√ÉO</button>
                <div id="myScoreDisplay" class="score-card" style="display: none;"></div>
            </div>
        </div>

        <div id="palpite-view" class="view-hidden">
            <button id="goToDashboardBtn" class="secondary-btn back-btn">
                &lt; VOLTAR AO DASHBOARD
            </button>
            <h2 class="section-title">ADIVINHA OS PARES</h2>
            
            <div id="palpite-container">
                </div>
        </div>

        <div id="modal-palpite" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>QUEM TIROU <span id="quemTirouNome"></span>?</h2>
                <div id="lista-amigos-secretos"></div>
            </div>
        </div>
        <div id="overlay-bloqueio" class="overlay">
            <p>üö´ EDI√á√ÉO BLOQUEADA!</p>
            <p>PRAZO TERMINADO.</p>
        </div>
    </div>

    <script>
        // === VARI√ÅVEIS DE CONFIGURA√á√ÉO (AJUSTAR AQUI) ===
        const gerarAvatar = (nome) => `https://ui-avatars.com/api/?name=${encodeURIComponent(nome)}&size=80&background=00FFFF&color=1A1A1A&bold=true`;

        const PARTICIPANTES = [
            { id: 'u1', nome: 'Cristiane', foto: gerarAvatar('Cristiane') },
            { id: 'u2', nome: 'Emily', foto: gerarAvatar('Emily') },
            { id: 'u3', nome: 'Jeane', foto: gerarAvatar('Jeane') },
            { id: 'u4', nome: 'Jennifer', foto: gerarAvatar('Jennifer') },
            { id: 'u5', nome: 'Jo√£o Vitor', foto: gerarAvatar('Jo√£o Vitor') },
            { id: 'u6', nome: 'Juliana', foto: gerarAvatar('Juliana') },
            { id: 'u7', nome: 'M√¥nica', foto: gerarAvatar('M√¥nica') },
            { id: 'u8', nome: 'Nelson', foto: gerarAvatar('Nelson') },
            { id: 'u9', nome: 'Rafael', foto: gerarAvatar('Rafael') },
            { id: 'u10', nome: 'Rodrigo', foto: gerarAvatar('Rodrigo') },
            { id: 'u11', nome: 'Suellen', foto: gerarAvatar('Suellen') },
            { id: 'u12', nome: 'Thiago', foto: gerarAvatar('Thiago') }, 
        ];

        const DATA_LIMITE_ENVIO = new Date(2025, 11, 23, 23, 59, 59); 
        const VALOR_APOSTA_POR_PESSOA = 10.00;
        const GABARITO = {
            'u1': '', 'u2': '', 'u3': '', 'u4': '', 'u5': '', 'u6': '',
            'u7': '', 'u8': '', 'u9': '', 'u10': '', 'u11': '', 'u12': '',
        };

        // === VARI√ÅVEIS DE ESTADO E DOM ===
        const NUMERO_PARTICIPANTES = PARTICIPANTES.length;
        const STORAGE_KEY_PREFIX = 'bolao_palpites_';
        let usuarioLogadoId = 'u1'; 
        let edicaoPermitida = true;
        let timerInterval;
        let participanteAdivinhadoId = null; 

        // DOM Element Mapping
        const views = {
            dashboard: document.getElementById('dashboard-view'),
            palpite: document.getElementById('palpite-view')
        };
        const domElements = {
            // Timer
            days: document.getElementById('days'), hours: document.getElementById('hours'), minutes: document.getElementById('minutes'), seconds: document.getElementById('seconds'),
            // UI
            palpiteContainer: document.getElementById('palpite-container'), userSelect: document.getElementById('user-select'),
            // Status
            dataLimiteDisplay: document.getElementById('dataLimiteDisplay'), premioTotalDisplay: document.getElementById('premioTotalDisplay'), valorPalpiteDisplay: document.getElementById('valorPalpiteDisplay'), numParticipantesDisplay: document.getElementById('numParticipantesDisplay'), numPalpitesDisplay: document.getElementById('numPalpitesDisplay'),
            // Botoes
            goToPalpiteBtn: document.getElementById('goToPalpiteBtn'), goToDashboardBtn: document.getElementById('goToDashboardBtn'), exportBtn: document.getElementById('exportBtn'), showResultsBtn: document.getElementById('showResultsBtn'),
            // Modals/Overlays
            modal: document.getElementById('modal-palpite'), closeBtn: document.querySelector('.close-btn'), overlayBloqueio: document.getElementById('overlay-bloqueio'),
            // Resultados
            resultModeSection: document.getElementById('resultModeSection'), gabaritoWarning: document.getElementById('gabaritoWarning'), myScoreDisplay: document.getElementById('myScoreDisplay'),
            quemTirouNomeDisplay: document.getElementById('quemTirouNome'), listaAmigosSecretos: document.getElementById('lista-amigos-secretos'), countdownTimer: document.getElementById('countdown-timer'), countdownFinished: document.getElementById('countdown-finished')
        };
        
        // === FUN√á√ïES DE NAVEGA√á√ÉO ===
        const navigateTo = (viewId) => {
            views.dashboard.classList.remove('view-active');
            views.palpite.classList.remove('view-active');

            views.dashboard.classList.add('view-hidden');
            views.palpite.classList.add('view-hidden');

            const targetView = views[viewId];
            if (targetView) {
                targetView.classList.add('view-active');
                targetView.classList.remove('view-hidden');
            }
        };

        // === FUN√á√ïES DE L√ìGICA (Simplificadas) ===
        const carregarMeusPalpites = () => {
            const json = localStorage.getItem(STORAGE_KEY_PREFIX + usuarioLogadoId);
            try { return json ? JSON.parse(json) : {}; } catch (e) { return {}; }
        };

        const salvarPalpite = (quemTirouId, amigoSecretoId) => {
            if (!edicaoPermitida) return;
            const meusPalpites = carregarMeusPalpites();
            meusPalpites[quemTirouId] = amigoSecretoId;
            localStorage.setItem(STORAGE_KEY_PREFIX + usuarioLogadoId, JSON.stringify(meusPalpites));
            renderizarPalpites();
        };

        // === FUN√á√ïES DE TEMPO E EXIBI√á√ÉO (Corrigidas) ===
        const iniciarContagemRegressiva = () => {
            const diferenca = DATA_LIMITE_ENVIO.getTime() - new Date().getTime();
            const [umDia, umaHora, umMinuto, umSegundo] = [86400000, 3600000, 60000, 1000];

            if (diferenca < 0) {
                clearInterval(timerInterval);
                timerInterval = null; 
                domElements.countdownTimer.style.display = 'none';
                domElements.countdownFinished.style.display = 'block';
                verificarDataLimite();
                return;
            }

            const dias = Math.floor(diferenca / umDia);
            const horas = Math.floor((diferenca % umDia) / umaHora);
            const minutos = Math.floor((diferenca % umaHora) / umMinuto);
            const segundos = Math.floor((diferenca % umMinuto) / umSegundo);

            domElements.days.textContent = String(dias).padStart(2, '0');
            domElements.hours.textContent = String(horas).padStart(2, '0');
            domElements.minutes.textContent = String(minutos).padStart(2, '0');
            domElements.seconds.textContent = String(segundos).padStart(2, '0');
        };

        const verificarDataLimite = () => {
            const hoje = new Date();
            edicaoPermitida = !(hoje > DATA_LIMITE_ENVIO);

            if (!edicaoPermitida) {
                domElements.overlayBloqueio.style.display = 'flex';
                clearInterval(timerInterval);
            } else {
                 domElements.overlayBloqueio.style.display = 'none';
                 if (!timerInterval) {
                     // Garante que o timer inicia APENAS se n√£o estiver ativo
                     timerInterval = setInterval(iniciarContagemRegressiva, 1000); 
                 }
            }
            domElements.dataLimiteDisplay.textContent = DATA_LIMITE_ENVIO.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            renderizarSumarioFinanceiro();
            verificarModoResultados();
        };
        
        // === FUN√á√ïES DE RENDERIZA√á√ÉO ===
        const renderizarSumarioFinanceiro = () => {
            const totalArrecadado = VALOR_APOSTA_POR_PESSOA * NUMERO_PARTICIPANTES;

            domElements.valorPalpiteDisplay.textContent = VALOR_APOSTA_POR_PESSOA.toFixed(2).replace('.', ',');
            domElements.numParticipantesDisplay.textContent = NUMERO_PARTICIPANTES;
            domElements.numPalpitesDisplay.textContent = NUMERO_PARTICIPANTES - 1; 
            domElements.premioTotalDisplay.textContent = totalArrecadado.toFixed(2).replace('.', ',');
        };

        const renderizarPalpites = () => {
            const meusPalpites = carregarMeusPalpites();
            domElements.palpiteContainer.innerHTML = ''; 

            PARTICIPANTES.forEach(p => {
                const palpiteNome = PARTICIPANTES.find(a => a.id === meusPalpites[p.id])?.nome || 'N√£o Palpitado';
                const isSelf = p.id === usuarioLogadoId; 
                
                const card = document.createElement('div');
                card.classList.add('palpite-card');
                if (meusPalpites[p.id]) { card.classList.add('selecionado'); }
                if (!edicaoPermitida || isSelf) { card.classList.add('bloqueado'); }

                card.innerHTML = `
                    <img src="${p.foto}" alt="Avatar de ${p.nome}" class="avatar">
                    <div class="palpite-info">
                        <p class="palpite-quem-tirou">${p.nome}</p>
                        <p class="palpite-atual">${palpiteNome} ${!isSelf && !edicaoPermitida ? 'üîí' : (!isSelf ? '‚û°Ô∏è' : '')}</p>
                    </div>
                `;
                
                if (edicaoPermitida && !isSelf) {
                    card.addEventListener('click', () => abrirModalPalpite(p.id, p.nome));
                }
                domElements.palpiteContainer.appendChild(card);
            });
        };

        const abrirModalPalpite = (id, nome) => {
            if (!edicaoPermitida) return;
            participanteAdivinhadoId = id;
            domElements.quemTirouNomeDisplay.textContent = nome;
            domElements.listaAmigosSecretos.innerHTML = ''; 
            
            const meusPalpites = carregarMeusPalpites();
            const amigosSecretosJaEscolhidos = Object.values(meusPalpites);

            PARTICIPANTES.forEach(amigo => { 
                const btn = document.createElement('button');
                btn.textContent = `Acho que √© **${amigo.nome}**`;
                
                const naoESiProprio = amigo.id !== id;
                const isCurrentChoice = amigo.id === meusPalpites[id];
                const isChosenByOther = amigosSecretosJaEscolhidos.includes(amigo.id) && !isCurrentChoice;
                
                if (naoESiProprio && !isChosenByOther) {
                    btn.addEventListener('click', () => {
                        salvarPalpite(participanteAdivinhadoId, amigo.id);
                        domElements.modal.style.display = 'none';
                    });
                    if (isCurrentChoice) { btn.textContent += " (Atual)"; }
                } else {
                    btn.disabled = true;
                    if (naoESiProprio) {
                         btn.textContent += " (J√° Escolhido)";
                    } else {
                         btn.textContent += " (N√£o √© poss√≠vel)";
                    }
                }
                domElements.listaAmigosSecretos.appendChild(btn);
            });
            domElements.modal.style.display = 'block';
        };

        // ... [Fun√ß√µes de resultados e exporta√ß√£o (verificarModoResultados, calcularPontuacaoIndividual, renderizarPontuacao, exportarPalpites) permanecem sem altera√ß√£o l√≥gica] ...
        // (Ser√£o adicionadas no ficheiro JS para manter a simplicidade aqui)

        // === FUN√á√ÉO INIT E EVENTOS ===
        const init = () => {
            renderizarSumarioFinanceiro();
            verificarDataLimite(); 
            renderizarPalpites();

            PARTICIPANTES.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.nome;
                domElements.userSelect.appendChild(option);
            });
            domElements.userSelect.value = usuarioLogadoId; 

            // Event Listeners
            domElements.userSelect.addEventListener('change', (e) => {
                usuarioLogadoId = e.target.value;
                verificarDataLimite(); 
                renderizarPalpites();
                domElements.myScoreDisplay.style.display = 'none'; 
            });
            domElements.goToPalpiteBtn.addEventListener('click', () => navigateTo('palpite'));
            domElements.goToDashboardBtn.addEventListener('click', () => navigateTo('dashboard'));
            
            // ... (restante dos event listeners) ...
        };

        document.addEventListener('DOMContentLoaded', init); // Garantia de inicializa√ß√£o
        
    </script>
    </body>
</html>
